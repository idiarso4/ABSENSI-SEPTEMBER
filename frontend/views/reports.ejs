<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Laporan - SIM Sekolah</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="/css/style.css" rel="stylesheet">
</head>
<body>
    <%- include('partials/sidebar') %>

    <div class="main-content">
        <%- include('partials/header') %>

        <div class="container-fluid">
            <div class="row">
                <div class="col-12">
                    <div class="card">
                        <div class="card-header">
                            <h2><i class="fas fa-chart-bar"></i> Sistem Laporan</h2>
                        </div>
                        <div class="card-body">

                            <!-- Report Categories -->
                            <div class="row g-4">
                                <!-- Student Reports -->
                                <div class="col-md-6 col-lg-4">
                                    <div class="card h-100 border-primary">
                                        <div class="card-header bg-primary text-white">
                                            <h5 class="mb-0"><i class="fas fa-user-graduate"></i> Laporan Siswa</h5>
                                        </div>
                                        <div class="card-body">
                                            <p class="card-text">Laporan data siswa, biodata, dan statistik siswa</p>
                                            <div class="d-grid gap-2">
                                                <button class="btn btn-outline-primary" onclick="generateStudentReport('all')">
                                                    <i class="fas fa-users"></i> Semua Siswa
                                                </button>
                                                <button class="btn btn-outline-primary" onclick="generateStudentReport('by_class')">
                                                    <i class="fas fa-school"></i> Per Kelas
                                                </button>
                                                <button class="btn btn-outline-primary" onclick="generateStudentReport('by_major')">
                                                    <i class="fas fa-graduation-cap"></i> Per Jurusan
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Teacher Reports -->
                                <div class="col-md-6 col-lg-4">
                                    <div class="card h-100 border-success">
                                        <div class="card-header bg-success text-white">
                                            <h5 class="mb-0"><i class="fas fa-chalkboard-teacher"></i> Laporan Guru</h5>
                                        </div>
                                        <div class="card-body">
                                            <p class="card-text">Laporan data guru, mata pelajaran, dan performa mengajar</p>
                                            <div class="d-grid gap-2">
                                                <button class="btn btn-outline-success" onclick="generateTeacherReport('all')">
                                                    <i class="fas fa-users-cog"></i> Semua Guru
                                                </button>
                                                <button class="btn btn-outline-success" onclick="generateTeacherReport('by_subject')">
                                                    <i class="fas fa-book"></i> Per Mata Pelajaran
                                                </button>
                                                <button class="btn btn-outline-success" onclick="generateTeacherReport('performance')">
                                                    <i class="fas fa-chart-line"></i> Performa Mengajar
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Attendance Reports -->
                                <div class="col-md-6 col-lg-4">
                                    <div class="card h-100 border-info">
                                        <div class="card-header bg-info text-white">
                                            <h5 class="mb-0"><i class="fas fa-calendar-check"></i> Laporan Kehadiran</h5>
                                        </div>
                                        <div class="card-body">
                                            <p class="card-text">Laporan absensi siswa dan guru berdasarkan periode</p>
                                            <div class="d-grid gap-2">
                                                <button class="btn btn-outline-info" onclick="generateAttendanceReport('daily')">
                                                    <i class="fas fa-calendar-day"></i> Harian
                                                </button>
                                                <button class="btn btn-outline-info" onclick="generateAttendanceReport('monthly')">
                                                    <i class="fas fa-calendar-alt"></i> Bulanan
                                                </button>
                                                <button class="btn btn-outline-info" onclick="generateAttendanceReport('summary')">
                                                    <i class="fas fa-chart-pie"></i> Ringkasan
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Grade Reports -->
                                <div class="col-md-6 col-lg-4">
                                    <div class="card h-100 border-warning">
                                        <div class="card-header bg-warning text-dark">
                                            <h5 class="mb-0"><i class="fas fa-graduation-cap"></i> Laporan Nilai</h5>
                                        </div>
                                        <div class="card-body">
                                            <p class="card-text">Laporan nilai siswa per mata pelajaran dan semester</p>
                                            <div class="d-grid gap-2">
                                                <button class="btn btn-outline-warning" onclick="generateGradeReport('by_subject')">
                                                    <i class="fas fa-book-open"></i> Per Mata Pelajaran
                                                </button>
                                                <button class="btn btn-outline-warning" onclick="generateGradeReport('by_student')">
                                                    <i class="fas fa-user"></i> Per Siswa
                                                </button>
                                                <button class="btn btn-outline-warning" onclick="generateGradeReport('class_rank')">
                                                    <i class="fas fa-trophy"></i> Ranking Kelas
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Payment Reports -->
                                <div class="col-md-6 col-lg-4">
                                    <div class="card h-100 border-danger">
                                        <div class="card-header bg-danger text-white">
                                            <h5 class="mb-0"><i class="fas fa-money-bill-wave"></i> Laporan Pembayaran</h5>
                                        </div>
                                        <div class="card-body">
                                            <p class="card-text">Laporan pembayaran SPP dan tunggakan siswa</p>
                                            <div class="d-grid gap-2">
                                                <button class="btn btn-outline-danger" onclick="generatePaymentReport('paid')">
                                                    <i class="fas fa-check-circle"></i> Sudah Bayar
                                                </button>
                                                <button class="btn btn-outline-danger" onclick="generatePaymentReport('overdue')">
                                                    <i class="fas fa-exclamation-triangle"></i> Tunggakan
                                                </button>
                                                <button class="btn btn-outline-danger" onclick="generatePaymentReport('summary')">
                                                    <i class="fas fa-chart-bar"></i> Ringkasan Keuangan
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Subject Reports -->
                                <div class="col-md-6 col-lg-4">
                                    <div class="card h-100 border-secondary">
                                        <div class="card-header bg-secondary text-white">
                                            <h5 class="mb-0"><i class="fas fa-book"></i> Laporan Mata Pelajaran</h5>
                                        </div>
                                        <div class="card-body">
                                            <p class="card-text">Laporan mata pelajaran dan distribusi pengajar</p>
                                            <div class="d-grid gap-2">
                                                <button class="btn btn-outline-secondary" onclick="generateSubjectReport('all')">
                                                    <i class="fas fa-list"></i> Semua Mata Pelajaran
                                                </button>
                                                <button class="btn btn-outline-secondary" onclick="generateSubjectReport('by_type')">
                                                    <i class="fas fa-tags"></i> Per Tipe
                                                </button>
                                                <button class="btn btn-outline-secondary" onclick="generateSubjectReport('teacher_distribution')">
                                                    <i class="fas fa-user-friends"></i> Distribusi Guru
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Report Generation Form -->
                            <div class="row mt-4">
                                <div class="col-12">
                                    <div class="card">
                                        <div class="card-header">
                                            <h5><i class="fas fa-cogs"></i> Pengaturan Laporan</h5>
                                        </div>
                                        <div class="card-body">
                                            <form id="reportForm">
                                                <div class="row g-3">
                                                    <div class="col-md-3">
                                                        <label for="reportType" class="form-label">Tipe Laporan</label>
                                                        <select class="form-select" id="reportType" name="reportType" required>
                                                            <option value="">Pilih Tipe Laporan</option>
                                                            <option value="student">Laporan Siswa</option>
                                                            <option value="teacher">Laporan Guru</option>
                                                            <option value="attendance">Laporan Kehadiran</option>
                                                            <option value="grade">Laporan Nilai</option>
                                                            <option value="payment">Laporan Pembayaran</option>
                                                            <option value="subject">Laporan Mata Pelajaran</option>
                                                            <option value="classroom">Laporan Ruang Kelas</option>
                                                        </select>
                                                    </div>
                                                    <div class="col-md-3">
                                                        <label for="startDate" class="form-label">Tanggal Mulai</label>
                                                        <input type="date" class="form-control" id="startDate" name="startDate">
                                                    </div>
                                                    <div class="col-md-3">
                                                        <label for="endDate" class="form-label">Tanggal Akhir</label>
                                                        <input type="date" class="form-control" id="endDate" name="endDate">
                                                    </div>
                                                    <div class="col-md-3">
                                                        <label for="format" class="form-label">Format</label>
                                                        <select class="form-select" id="format" name="format" required>
                                                            <option value="pdf">PDF</option>
                                                            <option value="excel">Excel</option>
                                                            <option value="html">HTML</option>
                                                        </select>
                                                    </div>
                                                </div>
                                                <div class="row mt-3">
                                                    <div class="col-12">
                                                        <div class="d-flex gap-2">
                                                            <button type="button" class="btn btn-primary" onclick="generateCustomReport()">
                                                                <i class="fas fa-file-export"></i> Generate Laporan
                                                            </button>
                                                            <button type="button" class="btn btn-success" onclick="exportAllReports()">
                                                                <i class="fas fa-download"></i> Export Semua Data
                                                            </button>
                                                            <button type="button" class="btn btn-info" onclick="showReportStatistics()">
                                                                <i class="fas fa-chart-bar"></i> Statistik
                                                            </button>
                                                        </div>
                                                    </div>
                                                </div>
                                            </form>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Report Results -->
                            <div class="row mt-4">
                                <div class="col-12">
                                    <div class="card" id="reportResults" style="display: none;">
                                        <div class="card-header">
                                            <h5><i class="fas fa-file-alt"></i> Hasil Laporan</h5>
                                        </div>
                                        <div class="card-body">
                                            <div id="reportContent">
                                                <!-- Report content will be loaded here -->
                                            </div>
                                            <div class="mt-3">
                                                <button class="btn btn-primary" onclick="printReport()">
                                                    <i class="fas fa-print"></i> Print Laporan
                                                </button>
                                                <button class="btn btn-success" onclick="downloadReport()">
                                                    <i class="fas fa-download"></i> Download
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Report Statistics -->
                            <div class="row mt-4">
                                <div class="col-12">
                                    <div class="card">
                                        <div class="card-header">
                                            <h5><i class="fas fa-chart-pie"></i> Statistik Sistem</h5>
                                        </div>
                                        <div class="card-body">
                                            <div class="row text-center">
                                                <div class="col-md-2">
                                                    <div class="p-3 bg-primary text-white rounded">
                                                        <h3 id="totalStudents">-</h3>
                                                        <p class="mb-0">Total Siswa</p>
                                                    </div>
                                                </div>
                                                <div class="col-md-2">
                                                    <div class="p-3 bg-success text-white rounded">
                                                        <h3 id="totalTeachers">-</h3>
                                                        <p class="mb-0">Total Guru</p>
                                                    </div>
                                                </div>
                                                <div class="col-md-2">
                                                    <div class="p-3 bg-info text-white rounded">
                                                        <h3 id="totalSubjects">-</h3>
                                                        <p class="mb-0">Mata Pelajaran</p>
                                                    </div>
                                                </div>
                                                <div class="col-md-2">
                                                    <div class="p-3 bg-warning text-white rounded">
                                                        <h3 id="totalClassrooms">-</h3>
                                                        <p class="mb-0">Ruang Kelas</p>
                                                    </div>
                                                </div>
                                                <div class="col-md-2">
                                                    <div class="p-3 bg-danger text-white rounded">
                                                        <h3 id="totalPayments">-</h3>
                                                        <p class="mb-0">Pembayaran</p>
                                                    </div>
                                                </div>
                                                <div class="col-md-2">
                                                    <div class="p-3 bg-secondary text-white rounded">
                                                        <h3 id="totalAttendance">-</h3>
                                                        <p class="mb-0">Kehadiran</p>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Report Preview Modal -->
    <div class="modal fade" id="reportPreviewModal" tabindex="-1">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Preview Laporan</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div id="reportPreview" class="text-center">
                        <div class="spinner-border" role="status">
                            <span class="visually-hidden">Generating preview...</span>
                        </div>
                        <p>Menggenerate preview laporan...</p>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Tutup</button>
                    <button type="button" class="btn btn-primary" id="downloadReportBtn">Download</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="/js/validation.js"></script>
    <script src="/js/reports.js"></script>
    <script>
        // Initialize reports page
        document.addEventListener('DOMContentLoaded', function() {
            initializeReportsPage();
            loadSystemStatistics();
        });
    </script>
</body>
</html>
