<nav class="navbar navbar-expand-lg navbar-dark bg-primary">
  <div class="container">
    <a class="navbar-brand" href="/">SIM Sekolah</a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarNav">
      <ul class="navbar-nav me-auto">
        <li class="nav-item"><a class="nav-link" href="/dashboard">Dashboard</a></li>

        <!-- Akademik -->
        <li class="nav-item dropdown">
          <a class="nav-link dropdown-toggle" href="#" id="academicDropdown" role="button" data-bs-toggle="dropdown">Akademik</a>
          <ul class="dropdown-menu" aria-labelledby="academicDropdown">
            <li><h6 class="dropdown-header">Data Siswa & Guru</h6></li>
            <li><a class="dropdown-item" href="/students">Kelola Siswa</a></li>
            <% if (typeof user !== 'undefined' && user && user.role === 'admin') { %>
            <li><a class="dropdown-item" href="/students/photo-update">Update Foto Siswa</a></li>
            <li><a class="dropdown-item" href="/students/photo-update/manage">Manajemen Update Foto</a></li>
            <% } %>
            <li><a class="dropdown-item" href="/teachers">Kelola Guru</a></li>
            <li><hr class="dropdown-divider"></li>
            <li><h6 class="dropdown-header">Kurikulum</h6></li>
            <li><a class="dropdown-item" href="/subjects">Mata Pelajaran</a></li>
            <li><a class="dropdown-item" href="/classrooms">Ruang Kelas</a></li>
            <li><a class="dropdown-item" href="/assessments">Penilaian</a></li>
            <li><a class="dropdown-item" href="/grades">Nilai Siswa</a></li>
            <li><hr class="dropdown-divider"></li>
            <li><h6 class="dropdown-header">Jadwal</h6></li>
            <li><a class="dropdown-item" href="/schedules">Jadwal Pelajaran</a></li>
            <% if (typeof user !== 'undefined' && user && user.role === 'admin') { %>
            <li><a class="dropdown-item" href="/academic-calendar">Kalender Akademik</a></li>
            <li><a class="dropdown-item" href="/semester-management">Manajemen Semester</a></li>
            <% } else { %>
            <li class="dropdown-item disabled" title="Fitur dalam pengembangan">
              <i class="fas fa-tools me-2"></i>Kalender Akademik (Coming Soon)
            </li>
            <li class="dropdown-item disabled" title="Fitur dalam pengembangan">
              <i class="fas fa-tools me-2"></i>Manajemen Semester (Coming Soon)
            </li>
            <% } %>
          </ul>
        </li>

        <!-- Kehadiran -->
        <li class="nav-item dropdown">
          <a class="nav-link dropdown-toggle" href="#" id="attendanceDropdown" role="button" data-bs-toggle="dropdown">Kehadiran</a>
          <ul class="dropdown-menu" aria-labelledby="attendanceDropdown">
            <li><a class="dropdown-item" href="/attendance?view=daily">Kehadiran Harian</a></li>
            <li><a class="dropdown-item" href="/attendance?view=class">Kehadiran Kelas</a></li>
            <li><a class="dropdown-item" href="/attendance?view=reports">Laporan Kehadiran</a></li>
            <li><a class="dropdown-item" href="/attendance/face">Absensi (Face + Lokasi)</a></li>
            <% if (typeof user !== 'undefined' && user && user.role === 'admin') { %>
            <li><a class="dropdown-item" href="/attendance-calendar">Kalender Kehadiran</a></li>
            <% } else { %>
            <li class="dropdown-item disabled" title="Fitur dalam pengembangan">
              <i class="fas fa-tools me-2"></i>Kalender Kehadiran (Coming Soon)
            </li>
            <% } %>
          </ul>
        </li>


        <!-- Keuangan -->
        <li class="nav-item dropdown">
          <a class="nav-link dropdown-toggle" href="#" id="financeDropdown" role="button" data-bs-toggle="dropdown">Keuangan</a>
          <ul class="dropdown-menu" aria-labelledby="financeDropdown">
            <li><h6 class="dropdown-header">Pembayaran</h6></li>
            <li><a class="dropdown-item" href="/payments?type=spp">SPP Siswa</a></li>
            <li><a class="dropdown-item" href="/payments?type=activity">Kegiatan</a></li>
            <li><a class="dropdown-item" href="/payments?type=uniform">Seragam</a></li>
            <li><a class="dropdown-item" href="/payments?type=books">Buku</a></li>
            <% if (typeof user !== 'undefined' && user && user.role === 'admin') { %>
            <li><a class="dropdown-item" href="/invoices">Penagihan/Invoice</a></li>
            <li><a class="dropdown-item" href="/payment-reminders">Tunggakan</a></li>
            <% } else { %>
            <li class="dropdown-item disabled" title="Fitur dalam pengembangan">
              <i class="fas fa-tools me-2"></i>Penagihan/Invoice (Coming Soon)
            </li>
            <li class="dropdown-item disabled" title="Fitur dalam pengembangan">
              <i class="fas fa-tools me-2"></i>Tunggakan (Coming Soon)
            </li>
            <% } %>
            <li><hr class="dropdown-divider"></li>
            <li><a class="dropdown-item" href="/payments?view=reports">Laporan Keuangan</a></li>
          </ul>
        </li>

        <!-- Laporan -->
        <li class="nav-item dropdown">
          <a class="nav-link dropdown-toggle" href="#" id="reportsDropdown" role="button" data-bs-toggle="dropdown">Laporan</a>
          <ul class="dropdown-menu" aria-labelledby="reportsDropdown">
            <li><h6 class="dropdown-header">Laporan Akademik</h6></li>
            <li><a class="dropdown-item" href="/reports?type=academic">Nilai Akademik</a></li>
            <li><a class="dropdown-item" href="/reports?type=attendance">Kehadiran</a></li>
            <li><a class="dropdown-item" href="/reports?type=performance">Performa Siswa</a></li>
            <% if (typeof user !== 'undefined' && user && user.role === 'admin') { %>
            <li><a class="dropdown-item" href="/rapor">Rapor</a></li>
            <li><a class="dropdown-item" href="/nilai-analytics">Analitik Nilai</a></li>
            <% } else { %>
            <li class="dropdown-item disabled" title="Fitur dalam pengembangan">
              <i class="fas fa-tools me-2"></i>Rapor (Coming Soon)
            </li>
            <li class="dropdown-item disabled" title="Fitur dalam pengembangan">
              <i class="fas fa-tools me-2"></i>Analitik Nilai (Coming Soon)
            </li>
            <% } %>
            <li><hr class="dropdown-divider"></li>
            <li><h6 class="dropdown-header">Laporan Keuangan</h6></li>
            <li><a class="dropdown-item" href="/reports?type=payments">Pembayaran</a></li>
            <li><a class="dropdown-item" href="/reports?type=financial">Keuangan Sekolah</a></li>
            <li><hr class="dropdown-divider"></li>
            <li><h6 class="dropdown-header">Analitik & Ekspor</h6></li>
            <% if (typeof user !== 'undefined' && user && user.role === 'admin') { %>
            <li><a class="dropdown-item" href="/analytics-dashboard">Analytics Dashboard</a></li>
            <li><a class="dropdown-item" href="/export">Export (PDF/Excel)</a></li>
            <% } else { %>
            <li class="dropdown-item disabled" title="Fitur dalam pengembangan">
              <i class="fas fa-tools me-2"></i>Analytics Dashboard (Coming Soon)
            </li>
            <li class="dropdown-item disabled" title="Fitur dalam pengembangan">
              <i class="fas fa-tools me-2"></i>Export (PDF/Excel) (Coming Soon)
            </li>
            <% } %>
          </ul>
        </li>

        <!-- Manajemen PKL -->
        <li class="nav-item dropdown">
          <a class="nav-link dropdown-toggle" href="#" id="pklDropdown" role="button" data-bs-toggle="dropdown">Manajemen PKL</a>
          <ul class="dropdown-menu" aria-labelledby="pklDropdown">
            <% if (typeof user !== 'undefined' && user && user.role === 'admin') { %>
            <li><a class="dropdown-item" href="/pkl/absensi">Absensi</a></li>
            <li><a class="dropdown-item" href="/pkl/kunjungan">Kunjungan</a></li>
            <li><a class="dropdown-item" href="/pkl/kegiatan">Kegiatan</a></li>
            <li><a class="dropdown-item" href="/pkl/laporan-harian">Laporan Harian</a></li>
            <% } else { %>
            <li class="dropdown-item disabled" title="Fitur dalam pengembangan">
              <i class="fas fa-tools me-2"></i>Absensi (Coming Soon)
            </li>
            <li class="dropdown-item disabled" title="Fitur dalam pengembangan">
              <i class="fas fa-tools me-2"></i>Kunjungan (Coming Soon)
            </li>
            <li class="dropdown-item disabled" title="Fitur dalam pengembangan">
              <i class="fas fa-tools me-2"></i>Kegiatan (Coming Soon)
            </li>
            <li class="dropdown-item disabled" title="Fitur dalam pengembangan">
              <i class="fas fa-tools me-2"></i>Laporan Harian (Coming Soon)
            </li>
            <% } %>
          </ul>
        </li>

        <!-- Perizinan Siswa -->
        <li class="nav-item dropdown">
          <a class="nav-link dropdown-toggle" href="#" id="perizinanDropdown" role="button" data-bs-toggle="dropdown">Perizinan Siswa</a>
          <ul class="dropdown-menu" aria-labelledby="perizinanDropdown">
            <% if (typeof user !== 'undefined' && user && user.role === 'admin') { %>
            <li><a class="dropdown-item" href="/perizinan/izin-masuk">Izin Masuk</a></li>
            <li><a class="dropdown-item" href="/perizinan/izin-keluar">Izin Keluar</a></li>
            <li><a class="dropdown-item" href="/perizinan/laporan-guru-piket">Laporan Guru Piket</a></li>
            <% } else { %>
            <li class="dropdown-item disabled" title="Fitur dalam pengembangan">
              <i class="fas fa-tools me-2"></i>Izin Masuk (Coming Soon)
            </li>
            <li class="dropdown-item disabled" title="Fitur dalam pengembangan">
              <i class="fas fa-tools me-2"></i>Izin Keluar (Coming Soon)
            </li>
            <li class="dropdown-item disabled" title="Fitur dalam pengembangan">
              <i class="fas fa-tools me-2"></i>Laporan Guru Piket (Coming Soon)
            </li>
            <% } %>
          </ul>
        </li>

        <!-- Manajemen BK -->
        <li class="nav-item dropdown">
          <a class="nav-link dropdown-toggle" href="#" id="bkDropdown" role="button" data-bs-toggle="dropdown">Manajemen BK</a>
          <ul class="dropdown-menu" aria-labelledby="bkDropdown">
            <% if (typeof user !== 'undefined' && user && user.role === 'admin') { %>
            <li><a class="dropdown-item" href="/bk/penanganan-siswa">Penanganan Siswa</a></li>
            <li><a class="dropdown-item" href="/bk/daftar-kunjungan">Daftar Kunjungan</a></li>
            <li><a class="dropdown-item" href="/bk/surat-kesepakatan">Surat Kesepakatan</a></li>
            <% } else { %>
            <li class="dropdown-item disabled" title="Fitur dalam pengembangan">
              <i class="fas fa-tools me-2"></i>Penanganan Siswa (Coming Soon)
            </li>
            <li class="dropdown-item disabled" title="Fitur dalam pengembangan">
              <i class="fas fa-tools me-2"></i>Daftar Kunjungan (Coming Soon)
            </li>
            <li class="dropdown-item disabled" title="Fitur dalam pengembangan">
              <i class="fas fa-tools me-2"></i>Surat Kesepakatan (Coming Soon)
            </li>
            <% } %>
          </ul>
        </li>

        <!-- LMS -->
        <li class="nav-item dropdown">
          <a class="nav-link dropdown-toggle" href="#" id="lmsDropdown" role="button" data-bs-toggle="dropdown">LMS</a>
          <ul class="dropdown-menu" aria-labelledby="lmsDropdown">
            <% if (typeof user !== 'undefined' && user && user.role === 'admin') { %>
            <li><a class="dropdown-item" href="/lms/absensi-guru">Absensi Guru</a></li>
            <li><a class="dropdown-item" href="/lms/materi">Materi</a></li>
            <li><a class="dropdown-item" href="/lms/materi/daftar-soal">Daftar Soal</a></li>
            <li><a class="dropdown-item" href="/lms/ulangan">Ulangan</a></li>
            <% } else { %>
            <li class="dropdown-item disabled" title="Fitur dalam pengembangan">
              <i class="fas fa-tools me-2"></i>Absensi Guru (Coming Soon)
            </li>
            <li class="dropdown-item disabled" title="Fitur dalam pengembangan">
              <i class="fas fa-tools me-2"></i>Materi (Coming Soon)
            </li>
            <li class="dropdown-item disabled" title="Fitur dalam pengembangan">
              <i class="fas fa-tools me-2"></i>Daftar Soal (Coming Soon)
            </li>
            <li class="dropdown-item disabled" title="Fitur dalam pengembangan">
              <i class="fas fa-tools me-2"></i>Ulangan (Coming Soon)
            </li>
            <% } %>
          </ul>
        </li>

        <!-- Sistem -->
        <li class="nav-item dropdown">
          <a class="nav-link dropdown-toggle" href="#" id="systemDropdown" role="button" data-bs-toggle="dropdown">Sistem</a>
          <ul class="dropdown-menu" aria-labelledby="systemDropdown">
            <li><h6 class="dropdown-header">Manajemen Pengguna</h6></li>
            <li><a class="dropdown-item" href="/users">Kelola Pengguna</a></li>
            <li><a class="dropdown-item" href="/users?view=roles">Peran & Izin</a></li>
            <li><a class="dropdown-item" href="/tasks">Manajemen Tugas</a></li>
            <li><hr class="dropdown-divider"></li>
            <li><h6 class="dropdown-header">Pengaturan</h6></li>
            <li><a class="dropdown-item" href="/settings?section=academic">Pengaturan Akademik</a></li>
            <li><a class="dropdown-item" href="/settings?section=system">Sistem</a></li>
            <% if (typeof user !== 'undefined' && user && user.role === 'admin') { %>
            <li><a class="dropdown-item" href="/departments">Departemen</a></li>
            <% } %>
            <li><a class="dropdown-item" href="/backup">Backup & Restore</a></li>
            <li><a class="dropdown-item" href="/language">Bahasa</a></li>
          </ul>
        </li>
      </ul>

      <ul class="navbar-nav">
        <li class="nav-item dropdown">
          <a class="nav-link dropdown-toggle" href="#" id="userDropdown" role="button" data-bs-toggle="dropdown">Akun</a>
          <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="userDropdown">
            <li><a class="dropdown-item" href="/account">Profil Saya</a></li>
            <li><a class="dropdown-item" href="/users">Manajemen Akun</a></li>
            <li><a class="dropdown-item" href="/users?view=roles">Peran & Izin</a></li>
            <li><a class="dropdown-item" href="/change-password">Ubah Password</a></li>
            <li><hr class="dropdown-divider"></li>
            <li><a class="dropdown-item text-danger" href="#" id="logoutBtn">Logout</a></li>
          </ul>
        </li>
      </ul>
    </div>
  </div>
</nav>

<script>
  (function attachLogout(){
    const btn = document.getElementById('logoutBtn');
    if (btn) {
      btn.addEventListener('click', function(e) {
        e.preventDefault();
        try { localStorage.removeItem('token'); } catch (e) {}
        window.location.href = '/login';
      });
    }
  })();
</script>